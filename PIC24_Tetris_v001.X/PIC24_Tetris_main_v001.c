/*
 * File:   PIC24_Tetris_main_v001.c
 * Author(s): Jacob Sprafka
 *
 * Created on October 23, 2020, 7:08 PM
 */

// CW1: FLASH CONFIGURATION WORD 1 (see PIC24 Family Reference Manual 24.1)
#pragma config ICS = PGx1          // Comm Channel Select
#pragma config FWDTEN = OFF        // Watchdog Timer is disabled
#pragma config GWRP = OFF          // Writes to program memory are allowed
#pragma config GCP = OFF           // Code protection is disabled
#pragma config JTAGEN = OFF        // JTAG port is disabled


// CW2: FLASH CONFIGURATION WORD 2 (see PIC24 Family Reference Manual 24.1)
#pragma config I2C1SEL = PRI       // Use default SCL1/SDA1 pins
#pragma config IOL1WAY = OFF       // IOLOCK may be changed via unlocking seq
#pragma config OSCIOFNC = ON       // CLKO/RC15 functions as I/O pin
#pragma config FCKSM = CSECME      // Clock switching is enabled, Fail-Safe Clock Monitor is enabled
#pragma config FNOSC = FRCPLL      // Fast RC Oscillator with PLL module (FRCPLL)

#include "xc.h"
#include "PIC24_setup.h"
#include "spraf_Lab5_LCD.h"
#include "LCD_setup.h"

unsigned char NHD_Logo[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0x7C, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0xF8, 0xF8, 0xF0, 0x00, 0x00, 0xF8, 0xF8, 0x00, 0x00, 0x00,
    0x00, 0xC0, 0xF0, 0x78, 0x78, 0x78, 0x78, 0x78, 0x00, 0x00, 0x00, 0xF8, 0xF0, 0x00, 0x00, 0x00,
    0xF8, 0xF8, 0xC0, 0x00, 0x00, 0xC0, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0x00, 0x00, 0x00,
    0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF8, 0xF8, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xF8, 0xF8, 0xC0, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0x80, 0xF0, 0xF0, 0x78, 0x78,
    0x78, 0x78, 0x00, 0x00, 0x00, 0xF8, 0xF8, 0xF8, 0xC0, 0x00, 0x00, 0xF8, 0xF8, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x07, 0x0B, 0x1F, 0x1F, 0x17, 0x0B, 0x01, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0xFF, 0x01, 0x07, 0xF8, 0xC0, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF8, 0x00, 0xFF,
    0x7F, 0x03, 0xFF, 0xE0, 0x00, 0xFF, 0x3F, 0x03, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x78, 0x70, 0x78,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xBF, 0x8F, 0x81, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00,
    0x0F, 0x3F, 0xFF, 0x00, 0xE0, 0xF8, 0x0F, 0x01, 0x00, 0x00, 0xF8, 0xFF, 0x79, 0x78, 0x70, 0x70,
    0x70, 0x70, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x1F, 0xF0, 0xE0, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF8, 0xFE, 0xFF, 0xFF, 0xF8, 0xD0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xB8, 0x3C, 0x07, 0x03, 0x80, 0xF0, 0xF0, 0xF0,
    0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0xFF, 0x00, 0x00, 0x03, 0x3F, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x1F, 0x78, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0x7F,
    0x00, 0x00, 0x1F, 0xFF, 0xFE, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xFF, 0x07, 0x07, 0x07, 0x07, 0x3F, 0xFF, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x01, 0xFF, 0xFF, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x01, 0x0F, 0x7C, 0x78, 0xF0, 0xF0,
    0xF0, 0xF0, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x07, 0x1F, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0E, 0x3F, 0xFF, 0xFF, 0xFF, 0x7F, 0x1B,
    0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0E, 0x0F, 0x03, 0x00, 0x00, 0xE0, 0x7C, 0x0F, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xE0, 0x80, 0x00, 0x00, 0x00,
    0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00,
    0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x80, 0xF0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xE0, 0xF4, 0xFE, 0xFF, 0xFE, 0xFC, 0x80, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 0x2E, 0x1D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x7F, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xC0, 0xC0, 0xC0, 0xC0, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF, 0x07, 0x3F, 0xFE, 0xE0, 0x00, 0x00, 0x00,
    0x00, 0x03, 0x07, 0xF8, 0xFE, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x0F, 0x7F, 0xFF, 0xFF, 0xFF, 0x3F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0B, 0x0F, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xE0, 0xE0, 0xE0, 0xE0, 0xFC, 0x3F, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE1, 0xF1, 0xFF, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xE0,
    0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x80, 0xF8, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0xFF, 0xE0, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x01, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

void clearLCD1(void) {
    unsigned int i, j;
    unsigned int page = 0xffB0;
    lcdCmd(0xff40); //Display start address + 0x40
    for (i = 0; i < 8; i++) { //64pixel display / 8 pixels per page = 8 pages
        lcdCmd(page); //send page address
        lcdCmd(0xff10); //column address upper 4 bits + 0x10
        lcdCmd(0xff00); //column address lower 4 bits + 0x00
        for (j = 0; j < 128; j++) { //128 columns wide
            lcdData(0xffff); //send picture data

        }
        page++; //after 128 columns, go to next page
    }
}

int main(void) {

    //Setup
    initPIC();
    initLCD();
    clearLCD();

    PR1 = 25000;
    _T1IF = 0;
    _T1IP = 4;
    _T1IE = 1;
    T1CON = 0x30;


    //Main game loop
    while (1) {
        _TON = 1;
        while(!_T1IF);
        clearLCD1();
        _TON = 1;
        while(!_T1IF);
        clearLCD();
    }

    return 0;
}
